if exist('shoredata.mat','file') == 0
  errordlg('shoredata.mat does not exist','Error','modal');
  return
end
if exist('net.mat','file') == 0
  errordlg('net.mat does not exist','Error','modal');
  return
end

load shoredata
% load net

% should be generated by user input
load simdist
di = dist;
%%%%%%%%%%%%%%%%%%%%

NumberOfImages = size(eimg,2);
% last edge image for imshow
LastEdgeImage = cell2mat(eimg(NumberOfImages));
w = size(LastEdgeImage,2);
h = size(LastEdgeImage,1);
% last points on edge line
LastPoints = cell2mat(points(NumberOfImages));
% the resultant point (64 rows * 2 cols)
p = zeros(length(di),2);

% p = (a,b), where a = x or column
%                  b = y or row
for i = 1:length(di)
  % from top left => -0:-90
  % the line is from (0,0)
  x = LastPoints(i,1); % => column/width
  y = LastPoints(i,2); % => row/height
  
  if ncatdeg(i) <= 0 && ncatdeg(i) >= -90     
    originx = 0; originy = 0;
%     tant = (x-originx)/(y-originy);
    tant = tan(deg2rad(abs(ncatdeg(i))));
    sint = sin(atan(tant));
    cost = cos(atan(tant));
    % the X coordinate
    p(i,1) = (sint*di(i)) + x;
    % the Y coordinate
    p(i,2) = (cost*di(i)) + y;
    
  % from top right => +5:+90
  elseif ncatdeg(i) >= 5 && ncatdeg(i) <= 90
    originx = w; originy = 0;
%     tant = (originx-x)/(y-originy);
    tant = tan(deg2rad(abs(ncatdeg(i))));
    sint = sin(atan(tant));
    cost = cos(atan(tant));
    % the X coordinate
    p(i,1) = x - (sint*di(i));
    % the Y coordinate
    p(i,2) = (cost*di(i)) + y;
    
  % from bottom left: -5000:-90000
  elseif ncatdeg(i) <= -5000 && ncatdeg(i) >= -90000
    originx = 0; originy = h;
%     tant = (x-originx)/(originy-y);
    tant = tan(deg2rad(abs(ncatdeg(i)/1000)));
    sint = sin(atan(tant));
    cost = cos(atan(tant));
    % the X coordinate
    p(i,1) = x - (sint*di(i));
    % the Y coordinate
    p(i,2) = (cost*di(i)) + y;
  
  % from bottom right
  elseif ncatdeg(i) >= 5000 && ncatdeg(i) <= 90000
    originx = w; originy = h;
%     tant = (originx-x)/(originy-y);
    tant = tan(deg2rad(abs(ncatdeg(i)/1000)));
    sint = sin(atan(tant));
    cost = cos(atan(tant));
    % the X coordinate
    p(i,1) = x + (sint*di(i));
    % the Y coordinate
    p(i,2) = (cost*di(i)) + y;
  end
end

t = p(:,1);
po = p(:,2);
xi =  1:1:w;
yi = interp1(t,po,xi,'linear');

imshow(LastEdgeImage)
hold on
plot(p(:,1),p(:,2),'or');
plot(xi,yi)
text(10,10,'--- Data in last year','Color',[1 1 1]);
text(10,30,'--- Data in prediction year','Color','b');
